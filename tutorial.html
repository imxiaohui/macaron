

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; Macaron v0.3.0-dev documentation</title>
    <link rel="stylesheet" href="static/macaron.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Macaron v0.3.0-dev documentation" href="index.html" />
    <link rel="next" title="Macaron in Web Application" href="webapp.html" />
    <link rel="prev" title="Macaron: O/R Mapper" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="webapp.html" title="Macaron in Web Application"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Macaron: O/R Mapper"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Macaron v0.3.0-dev documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="static/macaron_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#definition-of-models">Definition of models</a></li>
<li><a class="reference internal" href="#creating-new-records">Creating new records</a></li>
<li><a class="reference internal" href="#fetching-records-and-updating">Fetching records and updating</a></li>
<li><a class="reference internal" href="#aggregation">Aggregation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">Macaron: O/R Mapper</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="webapp.html"
                        title="next chapter">Macaron in Web Application</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>Here is a tutorial for <em>Macaron</em>. <em>Macaron</em> is a simplified ORM, so there are few things you need to learn.</p>
<div class="section" id="definition-of-models">
<h2>Definition of models<a class="headerlink" href="#definition-of-models" title="Permalink to this headline">¶</a></h2>
<p><em>Macaron</em> needs tables in SQLite database. To make it simple, <em>Macaron</em> does not provides methods for creating tables. In this section, table creation SQL and definition is below.</p>
<p>SQL:</p>
<div class="highlight-python"><pre>CREATE TABLE team (
    id      INTEGER PRIMARY KEY,
    name    TEXT
);

CREATE TABLE member (
    id          INTEGER PRIMARY KEY,
    table_id    INTEGER REFERENCES team (id),
    first_name  TEXT,
    last_name   TEXT,
    part        TEXT,
    age         INT
);</pre>
</div>
<p>You need creating tables into <em>members.db</em> file with the SQL.</p>
<p>Model definition in Python code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">macaron</span>

<span class="k">class</span> <span class="nc">Team</span><span class="p">(</span><span class="n">macaron</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Definition of Team table&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;Team &#39;</span><span class="si">%s</span><span class="s">&#39;&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Member</span><span class="p">(</span><span class="n">macaron</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Definition of Member table</span>
<span class="sd">    team is a class property and accessor for parent &#39;Team&#39; object.</span>
<span class="sd">    Macaron detects some field types, but if you want to validate, defining criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">team</span> <span class="o">=</span> <span class="n">macaron</span><span class="o">.</span><span class="n">ManyToOne</span><span class="p">(</span><span class="s">&quot;team_id&quot;</span><span class="p">,</span> <span class="n">Team</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;members&quot;</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">macaron</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;Member &#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> : </span><span class="si">%s</span><span class="s">&#39;&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">part</span><span class="p">)</span>
</pre></div>
</div>
<p>In these case, Team and Member classes correspond to &#8216;team&#8217; and &#8216;member&#8217; tables, respectively. So <em>Macaron</em> uses uncapitalized class names as table name. If not so, define <tt class="docutils literal"><span class="pre">_table_name</span></tt> for corresponding table name as a class property. Like this,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">macaron</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_table_name</span> <span class="o">=</span> <span class="s">&quot;my_profile&quot;</span>
</pre></div>
</div>
<p>The class property of <tt class="docutils literal"><span class="pre">_table_name</span></tt> is removed when initializing in Meta-class ModelMeta.</p>
</div>
<div class="section" id="creating-new-records">
<h2>Creating new records<a class="headerlink" href="#creating-new-records" title="Permalink to this headline">¶</a></h2>
<p>Okay, we have created some tables and defined model classes. Team class is the model related to team table in database and Member class is to member. After that, we will create a new team called &#8220;Houkago Tea Time&#8221; and append starting members.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">macaron</span>

<span class="c"># A macaron needs &#39;macaronage&#39; process.</span>
<span class="c"># First of all, call macaron.macaronage() to initialize macaron. This method</span>
<span class="c"># connect to &#39;members.db&#39; SQLite database file.</span>
<span class="n">macaron</span><span class="o">.</span><span class="n">macaronage</span><span class="p">(</span><span class="s">&quot;members.db&quot;</span><span class="p">)</span>

<span class="c"># Create a new team named &#39;Houkago Tea Time&#39;.</span>
<span class="c"># A new team is created with Model.create(). The create() is a class method and is called</span>
<span class="c"># with key word arguments which consist of field name and value pairs. It returns created Team</span>
<span class="c"># object.</span>
<span class="n">new_team</span> <span class="o">=</span> <span class="n">Team</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Houkago Tea Time&quot;</span><span class="p">)</span>

<span class="c"># Append new members to the team.</span>
<span class="c"># The Team object is into a variable named &#39;new_team&#39;, you will call new_team.members.append().</span>
<span class="c"># &#39;new_team.members&#39; is an accessor for Members. The append() can be used with key word</span>
<span class="c"># arguments like create() method and returns new created Member object.</span>
<span class="n">member1</span> <span class="o">=</span> <span class="n">new_team</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">&quot;Ritsu&quot;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">&quot;Tainaka&quot;</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="s">&quot;Dr&quot;</span><span class="p">)</span>
<span class="n">member2</span> <span class="o">=</span> <span class="n">new_team</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">&quot;Mio&quot;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">&quot;Akiyama&quot;</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="s">&quot;Ba&quot;</span><span class="p">)</span>

<span class="c"># Yeah, all tasks has been done. Let&#39;s bake the macaron.</span>
<span class="c"># At last, we have created a team with initial members and should commit it. Call</span>
<span class="c"># macaron.bake() which is a very wrapper to call sqlite3.Connection#commit().</span>
<span class="n">macaron</span><span class="o">.</span><span class="n">bake</span><span class="p">()</span>
</pre></div>
</div>
<p>Where the <em>members</em> propery is defined? The property is defined automatically in Member class definition. The <em>team</em> property of Member is set as an instance of <em>ManyToOne</em> and it works as accessor to many to one relationship. The ManyToOne add a property for accessing reverse relationship to Team class. In this case, the property is named <em>members</em>.</p>
</div>
<div class="section" id="fetching-records-and-updating">
<h2>Fetching records and updating<a class="headerlink" href="#fetching-records-and-updating" title="Permalink to this headline">¶</a></h2>
<p>Now, we have a small database <em>members.db</em>. In this section, we try fetching records.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">macaron</span>

<span class="n">macaron</span><span class="o">.</span><span class="n">macaronage</span><span class="p">(</span><span class="n">dbfile</span><span class="o">=</span><span class="s">&quot;members.db&quot;</span><span class="p">)</span>

<span class="c"># The simplest way is get() with record ID.</span>
<span class="n">ritsu</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c"># &lt;Member &#39;Ritsu Tainaka : Dr&#39;&gt;</span>

<span class="c"># Fetching Team object Ritsu belongs to.</span>
<span class="n">ourband</span> <span class="o">=</span> <span class="n">ritsu</span><span class="o">.</span><span class="n">team</span>
<span class="c"># &lt;Team &#39;Houkago Tea Time&#39;&gt;</span>

<span class="c"># And listing members who belongs to the team.</span>
<span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">ourband</span><span class="o">.</span><span class="n">members</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">members</span>
<span class="c"># &lt;Member &#39;Ritsu Tainaka : Dr&#39;&gt;</span>
<span class="c"># &lt;Member &#39;Mio Akiyama : Ba&#39;&gt;</span>

<span class="c"># You can get the member with index.</span>
<span class="n">mio</span> <span class="o">=</span> <span class="n">ourband</span><span class="o">.</span><span class="n">members</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c"># &lt;Member &#39;Mio Akiyama : Ba&#39;&gt;</span>

<span class="c"># Of course, you can SELECT with WHERE clause.</span>
<span class="c"># The get() returns a single object and select() returns generator.</span>
<span class="n">mio</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;last_name=?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;Akiyama&quot;</span><span class="p">])</span>

<span class="n">members</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&quot;team_id=?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">ourband</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
<span class="c"># [&lt;Member object 1&gt;, &lt;Member object 2&gt;]</span>

<span class="c"># Oops, Mio desides to sing the song.</span>
<span class="n">mio</span><span class="o">.</span><span class="n">part</span> <span class="o">=</span> <span class="s">&quot;Vo&quot;</span>
<span class="n">mio</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="k">print</span> <span class="s">&quot;Mio&#39;s part is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">mio</span><span class="o">.</span><span class="n">part</span>
<span class="c"># Mio&#39;s part is Vo.</span>

<span class="c"># But she canceled it.</span>
<span class="n">macaron</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="c"># Done.</span>
<span class="n">macaron</span><span class="o">.</span><span class="n">db_close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="aggregation">
<h2>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h2>
<p>These are how to use aggregation methods. Aggregation is conducted with aggregate() method. The aggregate method takes single argument which is sub class of AggregateFunction. Currently, there are Sum(), Ave(), Max(), and Min(). The constructor of AggregateFunction class takes column name as argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Count</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">Team</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c"># Sum</span>
<span class="n">sum_of_ages</span> <span class="o">=</span> <span class="n">Team</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">macaron</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">))</span>

<span class="c"># And you can use: average, max, and min are Ave(), Max(), Min(), respectively.</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="webapp.html" title="Macaron in Web Application"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Macaron: O/R Mapper"
             >previous</a> |</li>
        <li><a href="index.html">Macaron v0.3.0-dev documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Nobuo Okazaki.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>